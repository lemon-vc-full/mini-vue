{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/utils.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 获取原来数组方法\r\nlet oldArrayProtoMethods = Array.prototype;\r\n\r\n// 继承一下\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods);\r\n\r\n// 要重写的方法\r\nlet methods = [\"push\", \"shift\", \"unshift\", \"pop\", \"reverse\", \"sort\", \"splice\"];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    // 调用原来的方法,这里的this指向的是数组\r\n    let result = oldArrayProtoMethods[method].call(this, ...args);\r\n    // 如果用户调用的是push、unshift、splice这三个方法，那么插入的值也有可能是对象，应该被观测\r\n    let inserted;\r\n    switch (method) {\r\n      // push、unshift都是追加，所以args就是插入的值\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      // splice(start, deleteCount, inserted) 从第三个参数开始才是插入的值\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n        break;\r\n    }\r\n    // 获取这个数组对应的Observer实例\r\n    let ob = this.__ob__;\r\n    // 如果有插入的值，那么需要观测\r\n    if (inserted) {\r\n      ob.observeArray(inserted);\r\n    }\r\n    return result;\r\n  };\r\n});\r\n","import { arrayMethods } from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    /**\r\n     * 给value添加一个__ob__属性，这个属性不能被枚举，防止死循环\r\n     * __ob__属性的值是Observer实例，类中的this指向的就是实例\r\n     */\r\n    Object.defineProperty(value, \"__ob__\", {\r\n      value: this,\r\n      enumerable: false,\r\n    });\r\n    // 如果是数组的话并不会对索引进行观测，因为会导致性能问题\r\n    if (Array.isArray(value)) {\r\n      // 设置原型，让数组通过原型链查找的方法变成重写后的方法\r\n      Object.setPrototypeOf(value, arrayMethods);\r\n      // 遍历数组中的每一项进行递归观测\r\n      this.observeArray(value);\r\n    } else {\r\n      this.walk(value);\r\n    }\r\n  }\r\n  // 对象的观测，对每个属性进行观测\r\n  walk(data) {\r\n    let keys = Object.keys(data);\r\n    for (let i = 0; i < keys.length; i++) {\r\n      let key = keys[i];\r\n      let value = data[key];\r\n      defineReactive(data, key, value);\r\n    }\r\n  }\r\n  // 数组的特殊遍历，如果是对象类型会被直接观测\r\n  observeArray(value) {\r\n    for (let i = 0; i < value.length; i++) {\r\n      observe(value[i]);\r\n    }\r\n  }\r\n}\r\n\r\n// 观测数据\r\nexport function observe(data) {\r\n  // 如果不是对象或者数组，就不用观测了，直接返回\r\n  if (typeof data !== \"object\" || data === null) {\r\n    return data;\r\n  }\r\n  // 如果是对象或者数组，就创建一个Observer实例\r\n  return new Observer(data);\r\n}\r\n\r\n// 定义响应式数据\r\nfunction defineReactive(data, key, value) {\r\n  // 递归，如果value是对象的话，继续观测\r\n  observe(value);\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return;\r\n      // 如果用户设置的是对象，那么继续观测\r\n      observe(newValue);\r\n      value = newValue;\r\n    },\r\n  });\r\n}\r\n","export function proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key];\r\n    },\r\n    set(newValue) {\r\n      vm[source][key] = newValue;\r\n    },\r\n  });\r\n}\r\n","import { observe } from \"./observer/index.js\";\r\nimport { proxy } from \"./utils.js\";\r\n\r\nexport function initState(vm) {\r\n  let ops = vm.$options;\r\n  // 判断\r\n  if (ops.props) {\r\n    initProps(vm);\r\n  }\r\n  if (ops.data) {\r\n    initData(vm);\r\n  }\r\n  if (ops.computed) {\r\n    initComputed(vm);\r\n  }\r\n  if (ops.watch) {\r\n    initWatch(vm);\r\n  }\r\n  if (ops.methods) {\r\n    initMethods(vm);\r\n  }\r\n}\r\n\r\nfunction initProps(vm) {}\r\n\r\nfunction initData(vm) {\r\n  // 数据初始化\r\n  let data = vm.$options.data;\r\n  // 判断data是不是函数\r\n  // 这里的initData是一个普通函数，不是Vue实例或原型链的方法，所以这里的this指向是undefined\r\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data;\r\n  // 将data中的数据全部代理到vm实例上\r\n  for (let key in data) {\r\n    proxy(vm, \"_data\", key);\r\n  }\r\n  // 数据代理\r\n  observe(data);\r\n}\r\n\r\nfunction initComputed(vm) {}\r\n\r\nfunction initWatch(vm) {}\r\n\r\nfunction initMethods(vm) {}\r\n","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    let vm = this;\r\n    vm.$options = options;\r\n    // 初始化状态\r\n    initState(vm);\r\n  };\r\n}\r\n","import { initMixin } from \"./init.js\";\r\n\r\nfunction Vue(options) {\r\n  // 初始化\r\n  this._init(options);\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","_oldArrayProtoMethods","_len","arguments","length","args","_key","result","call","apply","concat","inserted","slice","ob","__ob__","observeArray","Observer","value","_classCallCheck","defineProperty","enumerable","isArray","setPrototypeOf","walk","_createClass","key","data","keys","i","defineReactive","observe","_typeof","get","set","newValue","proxy","vm","source","initState","ops","$options","props","initData","computed","watch","_data","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA,IAAIA,oBAAoB,GAAGC,KAAK,CAACC,SAAS,CAAA;;EAE1C;EACO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAM,CAACL,oBAAoB,CAAC,CAAA;;EAE7D;EACA,IAAIM,OAAO,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,KAAK,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAA;EAE9EA,OAAO,CAACC,OAAO,CAAC,UAACC,MAAM,EAAK;EAC1BL,EAAAA,YAAY,CAACK,MAAM,CAAC,GAAG,YAAmB;EAAA,IAAA,IAAAC,qBAAA,CAAA;EAAA,IAAA,KAAA,IAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAANC,IAAI,GAAAZ,IAAAA,KAAA,CAAAS,IAAA,GAAAI,IAAA,GAAA,CAAA,EAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA,EAAA,EAAA;EAAJD,MAAAA,IAAI,CAAAC,IAAA,CAAAH,GAAAA,SAAA,CAAAG,IAAA,CAAA,CAAA;EAAA,KAAA;EACtC;MACA,IAAIC,MAAM,GAAG,CAAAN,qBAAA,GAAAT,oBAAoB,CAACQ,MAAM,CAAC,EAACQ,IAAI,CAAAC,KAAA,CAAAR,qBAAA,EAAA,CAAC,IAAI,CAAAS,CAAAA,MAAA,CAAKL,IAAI,CAAC,CAAA,CAAA;EAC7D;EACA,IAAA,IAAIM,QAAQ,CAAA;EACZ,IAAA,QAAQX,MAAM;EACZ;EACA,MAAA,KAAK,MAAM,CAAA;EACX,MAAA,KAAK,SAAS;EACZW,QAAAA,QAAQ,GAAGN,IAAI,CAAA;EACf,QAAA,MAAA;EACF;EACA,MAAA,KAAK,QAAQ;EACXM,QAAAA,QAAQ,GAAGN,IAAI,CAACO,KAAK,CAAC,CAAC,CAAC,CAAA;EACxB,QAAA,MAAA;EACJ,KAAA;EACA;EACA,IAAA,IAAIC,EAAE,GAAG,IAAI,CAACC,MAAM,CAAA;EACpB;EACA,IAAA,IAAIH,QAAQ,EAAE;EACZE,MAAAA,EAAE,CAACE,YAAY,CAACJ,QAAQ,CAAC,CAAA;EAC3B,KAAA;EACA,IAAA,OAAOJ,MAAM,CAAA;KACd,CAAA;EACH,CAAC,CAAC;;EClCqC,IAEjCS,QAAQ,gBAAA,YAAA;IACZ,SAAAA,QAAAA,CAAYC,KAAK,EAAE;EAAAC,IAAAA,eAAA,OAAAF,QAAA,CAAA,CAAA;EACjB;EACJ;EACA;EACA;EACIpB,IAAAA,MAAM,CAACuB,cAAc,CAACF,KAAK,EAAE,QAAQ,EAAE;EACrCA,MAAAA,KAAK,EAAE,IAAI;EACXG,MAAAA,UAAU,EAAE,KAAA;EACd,KAAC,CAAC,CAAA;EACF;EACA,IAAA,IAAI3B,KAAK,CAAC4B,OAAO,CAACJ,KAAK,CAAC,EAAE;EACxB;EACArB,MAAAA,MAAM,CAAC0B,cAAc,CAACL,KAAK,EAAEtB,YAAY,CAAC,CAAA;EAC1C;EACA,MAAA,IAAI,CAACoB,YAAY,CAACE,KAAK,CAAC,CAAA;EAC1B,KAAC,MAAM;EACL,MAAA,IAAI,CAACM,IAAI,CAACN,KAAK,CAAC,CAAA;EAClB,KAAA;EACF,GAAA;EACA;EAAAO,EAAAA,YAAA,CAAAR,QAAA,EAAA,CAAA;MAAAS,GAAA,EAAA,MAAA;EAAAR,IAAAA,KAAA,EACA,SAAAM,IAAKG,CAAAA,IAAI,EAAE;EACT,MAAA,IAAIC,IAAI,GAAG/B,MAAM,CAAC+B,IAAI,CAACD,IAAI,CAAC,CAAA;EAC5B,MAAA,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,IAAI,CAACvB,MAAM,EAAEwB,CAAC,EAAE,EAAE;EACpC,QAAA,IAAIH,GAAG,GAAGE,IAAI,CAACC,CAAC,CAAC,CAAA;EACjB,QAAA,IAAIX,KAAK,GAAGS,IAAI,CAACD,GAAG,CAAC,CAAA;EACrBI,QAAAA,cAAc,CAACH,IAAI,EAAED,GAAG,EAAER,KAAK,CAAC,CAAA;EAClC,OAAA;EACF,KAAA;EACA;EAAA,GAAA,EAAA;MAAAQ,GAAA,EAAA,cAAA;EAAAR,IAAAA,KAAA,EACA,SAAAF,YAAaE,CAAAA,KAAK,EAAE;EAClB,MAAA,KAAK,IAAIW,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGX,KAAK,CAACb,MAAM,EAAEwB,CAAC,EAAE,EAAE;EACrCE,QAAAA,OAAO,CAACb,KAAK,CAACW,CAAC,CAAC,CAAC,CAAA;EACnB,OAAA;EACF,KAAA;EAAC,GAAA,CAAA,CAAA,CAAA;EAAA,EAAA,OAAAZ,QAAA,CAAA;EAAA,CAGH,EAAA,CAAA;EACO,SAASc,OAAOA,CAACJ,IAAI,EAAE;EAC5B;IACA,IAAIK,OAAA,CAAOL,IAAI,CAAA,KAAK,QAAQ,IAAIA,IAAI,KAAK,IAAI,EAAE;EAC7C,IAAA,OAAOA,IAAI,CAAA;EACb,GAAA;EACA;EACA,EAAA,OAAO,IAAIV,QAAQ,CAACU,IAAI,CAAC,CAAA;EAC3B,CAAA;;EAEA;EACA,SAASG,cAAcA,CAACH,IAAI,EAAED,GAAG,EAAER,KAAK,EAAE;EACxC;IACAa,OAAO,CAACb,KAAK,CAAC,CAAA;EACdrB,EAAAA,MAAM,CAACuB,cAAc,CAACO,IAAI,EAAED,GAAG,EAAE;MAC/BO,GAAG,EAAA,SAAAA,MAAG;EACJ,MAAA,OAAOf,KAAK,CAAA;OACb;MACDgB,GAAG,EAAA,SAAAA,GAACC,CAAAA,QAAQ,EAAE;QACZ,IAAIA,QAAQ,KAAKjB,KAAK,EAAE,OAAA;EACxB;QACAa,OAAO,CAACI,QAAQ,CAAC,CAAA;EACjBjB,MAAAA,KAAK,GAAGiB,QAAQ,CAAA;EAClB,KAAA;EACF,GAAC,CAAC,CAAA;EACJ;;EChEO,SAASC,KAAKA,CAACC,EAAE,EAAEC,MAAM,EAAEZ,GAAG,EAAE;EACrC7B,EAAAA,MAAM,CAACuB,cAAc,CAACiB,EAAE,EAAEX,GAAG,EAAE;MAC7BO,GAAG,EAAA,SAAAA,MAAG;EACJ,MAAA,OAAOI,EAAE,CAACC,MAAM,CAAC,CAACZ,GAAG,CAAC,CAAA;OACvB;MACDQ,GAAG,EAAA,SAAAA,GAACC,CAAAA,QAAQ,EAAE;EACZE,MAAAA,EAAE,CAACC,MAAM,CAAC,CAACZ,GAAG,CAAC,GAAGS,QAAQ,CAAA;EAC5B,KAAA;EACF,GAAC,CAAC,CAAA;EACJ;;ECNO,SAASI,SAASA,CAACF,EAAE,EAAE;EAC5B,EAAA,IAAIG,GAAG,GAAGH,EAAE,CAACI,QAAQ,CAAA;EACrB;IACA,IAAID,GAAG,CAACE,KAAK,EAAE,CAEf;IACA,IAAIF,GAAG,CAACb,IAAI,EAAE;MACZgB,QAAQ,CAACN,EAAE,CAAC,CAAA;EACd,GAAA;IACA,IAAIG,GAAG,CAACI,QAAQ,EAAE,CAElB;IACA,IAAIJ,GAAG,CAACK,KAAK,EAAE,CAEf;IACA,IAAIL,GAAG,CAACzC,OAAO,EAAE,CAEjB;EACF,CAAA;EAIA,SAAS4C,QAAQA,CAACN,EAAE,EAAE;EACpB;EACA,EAAA,IAAIV,IAAI,GAAGU,EAAE,CAACI,QAAQ,CAACd,IAAI,CAAA;EAC3B;EACA;EACAA,EAAAA,IAAI,GAAGU,EAAE,CAACS,KAAK,GAAG,OAAOnB,IAAI,KAAK,UAAU,GAAGA,IAAI,CAAClB,IAAI,CAAC4B,EAAE,CAAC,GAAGV,IAAI,CAAA;EACnE;EACA,EAAA,KAAK,IAAID,GAAG,IAAIC,IAAI,EAAE;EACpBS,IAAAA,KAAK,CAACC,EAAE,EAAE,OAAO,EAAEX,GAAG,CAAC,CAAA;EACzB,GAAA;EACA;IACAK,OAAO,CAACJ,IAAI,CAAC,CAAA;EACf;;ECnCO,SAASoB,SAASA,CAACC,GAAG,EAAE;EAC7BA,EAAAA,GAAG,CAACrD,SAAS,CAACsD,KAAK,GAAG,UAAUC,OAAO,EAAE;MACvC,IAAIb,EAAE,GAAG,IAAI,CAAA;MACbA,EAAE,CAACI,QAAQ,GAAGS,OAAO,CAAA;EACrB;MACAX,SAAS,CAACF,EAAE,CAAC,CAAA;KACd,CAAA;EACH;;ECPA,SAASW,GAAGA,CAACE,OAAO,EAAE;EACpB;EACA,EAAA,IAAI,CAACD,KAAK,CAACC,OAAO,CAAC,CAAA;EACrB,CAAA;EAEAH,SAAS,CAACC,GAAG,CAAC;;;;;;;;"}